--- a/src/main/java/com/mesutpiskin/keycloak/auth/email/EmailAuthenticatorForm.java
+++ b/src/main/java/com/mesutpiskin/keycloak/auth/email/EmailAuthenticatorForm.java
@@ -512,12 +512,8 @@ public class EmailAuthenticatorForm extends AbstractUsernameFormAuthenticator {
     }
 
     private String buildMagicLink(AuthenticationFlowContext context, String code) {
-        UriBuilder builder = UriBuilder.fromUri(context.getUriInfo().getRequestUri());
-        // NOTE: This link is only valid while the current Keycloak authentication
-        // session is alive.
-        // Keycloak requires the current flow parameters (like
-        // session_code/execution/tab_id/client_data)
-        // to resume the in-flight authentication. Removing them will typically result
-        // in "Page has expired".
-        builder.replaceQueryParam(EmailConstants.MAGIC_LINK_MARKER_PARAM);
-        builder.replaceQueryParam(EmailConstants.CODE);
+        // Use form action URL which has correct parameters
+        UriBuilder builder = UriBuilder.fromUri(context.getActionUrl(context.getExecution().getId()));
         builder.queryParam(EmailConstants.MAGIC_LINK_MARKER_PARAM, "1");
         builder.queryParam(EmailConstants.CODE, code);
         return builder.build().toString();
